<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <!-- JQuery -->
  <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
    crossorigin="anonymous"></script>
  <!-- Ajax -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
  <!-- Axios -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <!-- Bulma link -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
  <link rel="stylesheet" type="text/css" href="css.css">

  <title>메인페이지(게시글 목록)</title>

  <script>

    // const axios = require('axios'); // node.js에서 js 파일에 쓸 때는 이렇게 모듈 설치 코드가 필요하다
    // 여기선 html에 썼기 때문에 위에 달린 Axios 소스 코드를 썼다.

    async function newPosting() {


      const title = document.getElementById("title").value; // axios에선 ajax처럼 ${'#id'}.val()가 없어서 이렇게 써주어야 한다
      const author = document.getElementById("author").value;
      const text = document.getElementById("text").value;
      const pwd = document.getElementById("pwd").value;

      if (title && author && pwd) {
        try{
          return await (axios.post("/api/newPostings", { title, author, text, pwd }),
          alert('작성완료'),
          location.href = '/');
                } catch (error){
          console.error(error);
        }
      } else {
        alert("제목, 작성자명, 비밀번호 란을 모두 채워주세요.");
      }

      };
      
        
    
  </script>

</head>

<body>

  <!-- 메인 네비게이션 바 구역 -->

  <nav class="navbar bodyWidth" role="navigation" aria-label="main navigation">
    <div class="navbar-brand">
      <a class="navbar-item" href="/">
        <h2><strong>으디야! 커피입니다.</strong></h2>
      </a>

      <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navbarBasicExample">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </a>
    </div>

    <div id="navbarBasicExample" class="navbar-menu">
      <div class="navbar-start">
        <a class="navbar-item" href="/new_posting.html">
          게시글 작성
        </a>
      </div>

      <div class="navbar-end">
        <div class="navbar-item">
          <div class="buttons">
            <button class="button is-info" onclick="location.href = '/sign-in.html'"><strong>Sign in</strong></button>
                        <button class="button is-info is-light" onclick="location.href = '/sign-up.html'">Sign up</button>
            </a>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <hr>

  <!-- 게시글 노출 구역 -->
  <div id="postingsList" class="bodyWidth">
    <div class="field">
      <label class="label" >제목</label>
      <div class="control">
        <input class="input" type="text" placeholder="제목" id="title">
      </div>
    </div>

    <div class="field">
      <label class="label">작성자명</label>

      <input class="input" type="text" placeholder="작성자명을 입력해주세요." id="author">
      <span class="icon is-small is-left">
        <i class="fas fa-user"></i>
      </span>
      <span class="icon is-small is-right">
        <i class="fas fa-check"></i>
      </span>

      <p class="help is-success">This username is available</p>
    </div>

    <div class="field">
      <label class="label" >비밀번호</label>
      <input class="input" type="email" placeholder="비밀번호는 최대 10자리입니다." id="pwd" maxlength="10">
      <span class="icon is-small is-left">
        <i class="fas fa-envelope"></i>
      </span>
      <span class="icon is-small is-right">
        <i class="fas fa-exclamation-triangle"></i>
      </span>
      <p class="help is-danger">This email is invalid</p>
    </div>

    <div class="field">
      <label class="label">내용</label>
      <div class="control">
        <textarea class="textarea" placeholder="여기에 작성해주세요." id="text"></textarea>
      </div>
    </div>


    <div class="field is-grouped">
      <div class="control">
        <button class="button is-info" onclick="newPosting()">작성완료</button>
      </div>
      <div class="control">
        <button class="button is-info is-light" href="/">취소</button>
      </div>
    </div>
  </div>
</body>

</html>